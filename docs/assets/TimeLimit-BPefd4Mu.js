import{a as E,s as J,r as f,w as D,A as G,n as b,c as S,e as s,j as i,m as r,B as P,k as N,x as v,h as U,i as H,T as B,p as V,q as d,F as T,f as j,C as W,t as I,_ as Q}from"./index-CLtwyALV.js";import{u as X}from"./useSettingStore-ZZkmfUZe.js";let R=(M=21)=>crypto.getRandomValues(new Uint8Array(M)).reduce((_,c)=>(c&=63,c<36?_+=c.toString(36):c<62?_+=(c-26).toString(36).toUpperCase():c>62?_+="-":_+="_",_),"");const Y={class:"items-center column"},Z={class:"q-my-xl row card-container items-center"},ee={class:"q-mt-xl row items-center full-width"},te={class:"col row justify-end"},se={class:"input-container shadow-3"},oe={class:"col row justify-start"},ne={class:"btn-container shadow-3"},ae={class:"result-container"},le={class:"wpm correct"},re={key:0,class:"row item-container"},ce={class:"result-item col"},ie={class:"row"},ue={class:"result-item col"},de={class:"row"},me=E({__name:"TimeLimit",setup(M){const{allWords:_}=J(X()),c=f([]),p=f(),g=f(10);D(g,n=>{p.value=n},{deep:!0,immediate:!0});const h=f(!0),y=f(null);function $(n,t){let e="";return n==2?e+="mid-card ":(n==0||n==4)&&(e+="edge-card "),t.isCorrect!=null&&(t.isCorrect?e+="correct-card":e+="wrong-card"),e}const F=G(()=>{const n=Math.floor(p.value/60),t=p.value%60,e=String(n).padStart(2,"0"),a=String(t).padStart(2,"0");return`${e}:${a}`});let C;function O(){C||(C=setInterval(()=>{p.value--,p.value==0&&(clearInterval(C),z())},1e3))}function z(){m.value.forEach(l=>{l.cn="时间已到",l.en="timeout",l.isCorrect=!1}),h.value=!1;const n=c.value.filter(l=>l.isCorrect),t=c.value.filter(l=>!l.isCorrect);let a=n.length/g.value*60;a=Math.round(a*100)/100;const u=a.toFixed(2);w.value={wpm:u,correctWords:n,wrongWords:t}}const w=f({wpm:"",correctWords:[],wrongWords:[]}),k=f(""),m=f([]);q(!0);function A(n){if((n.code.startsWith("Key")||n.key==" ")&&O(),n.key==" "){const{id:t,en:e,cn:a}=m.value[2],u=k.value.trim(),l=u==e||u==a;c.value.push({id:t,cn:a,en:e,typing:u,isCorrect:l}),m.value[2].isCorrect=l,b(()=>{k.value=""}),m.value.shift(),q(!1)}}function K(){h.value=!0,m.value=[],c.value=[],k.value="",p.value=g.value,clearInterval(C),C=void 0,q(!0),b(()=>{y.value&&y.value.focus()})}function q(n){const t=JSON.parse(JSON.stringify(_.value));if(!t){console.error("当前无词块");return}if(t.length<5&&console.error("可用词块数不足5个！"),n){const e=[];for(let a=0;a<5;a++){const u=Math.floor(Math.random()*t.length);e.push({id:R(),...t[u]})}m.value=e}else{const e=t.splice(Math.floor(Math.random()*t.length),1)[0];m.value.push({id:R(),...e})}}return b(()=>{y.value&&y.value.focus()}),(n,t)=>{const e=V("q-card"),a=V("q-input"),u=V("q-popup-edit"),l=V("q-btn"),L=V("q-expansion-item");return d(),S("div",Y,[s("div",Z,[i(P,{name:"card",appear:""},{default:r(()=>[(d(!0),S(T,null,j(m.value,(o,x)=>(d(),W(e,{key:o.id,class:N([$(x,o),"column justify-center items-center shadow-5"])},{default:r(()=>[s("div",null,v(o.cn),1),s("div",null,v(o.en),1)]),_:2},1032,["class"]))),128))]),_:1})]),s("div",ee,[s("div",te,[s("div",null,[s("div",{class:N(["time-limit shadow-3",h.value?"":"wrong"])},v(F.value),3),i(u,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=o=>g.value=o),"auto-save":""},{default:r(o=>[i(a,{modelValue:o.value,"onUpdate:modelValue":x=>o.value=x,autofocus:"",onKeyup:U(o.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:1},8,["modelValue"])])]),s("div",se,[i(a,{ref_key:"inputRef",ref:y,disable:!h.value,modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=o=>k.value=o),onKeydown:A,"input-class":"input",borderless:""},null,8,["disable","modelValue"])]),s("div",oe,[s("div",ne,[i(l,{onKeydown:U(H(K,["prevent"]),["space"]),onClick:K,class:"re-btn",icon:"refresh",size:"lg",flat:""},null,8,["onKeydown"])])])]),s("div",ae,[i(B,{name:"wpm"},{default:r(()=>[h.value?I("",!0):(d(),W(e,{key:0,class:"shadow-3 row justify-center"},{default:r(()=>[s("div",le,"WPM "+v(w.value.wpm),1)]),_:1}))]),_:1}),i(B,{name:"word"},{default:r(()=>[h.value?I("",!0):(d(),S("div",re,[s("div",ce,[i(e,{class:"col shadow-3 correct row justify-center"},{default:r(()=>[i(L,{"header-class":"expansion",class:"fit",label:`正确 ${w.value.correctWords.length.toString()}`},{default:r(()=>[s("div",ie,[(d(!0),S(T,null,j(w.value.correctWords,o=>(d(),W(e,{class:"shadow-3 correct-card column justify-center items-center result-block"},{default:r(()=>[s("div",null,v(o.cn),1),s("div",null,v(o.typing),1)]),_:2},1024))),256))])]),_:1},8,["label"])]),_:1})]),s("div",ue,[i(e,{class:"col shadow-3 wrong row justify-center"},{default:r(()=>[i(L,{"header-class":"expansion",class:"fit",label:`错误 ${w.value.wrongWords.length.toString()}`},{default:r(()=>[s("div",de,[(d(!0),S(T,null,j(w.value.wrongWords,o=>(d(),W(e,{class:"shadow-3 wrong-card column justify-center items-center result-block"},{default:r(()=>[s("div",null,v(o.cn),1),s("div",null,v(o.typing),1)]),_:2},1024))),256))])]),_:1},8,["label"])]),_:1})])]))]),_:1})])])}}}),_e=Q(me,[["__scopeId","data-v-21a93a24"]]);export{_e as default};
