import{s as W,n as R,o as O,d as Y,r as K,a as Z,w as x,b as C,c as T,e as s,F,f as V,g as U,v as G,u as p,h as P,i as j,j as L,k as J,l as S,m as H,T as I,p as A,q as ee,t as q,x as te,y as se}from"./index-CfuvUzIg.js";import{u as $}from"./useTypingStore-BcbubNd8.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";function le(e){const{blockRefs:g,caret:u,blocksContainer:y}=W($()),k=()=>{const o=g.value[e.value[0]];if(!o){console.error("Block元素未定义");return}l(e.value[1],o)},l=(o,f)=>{if(!f){console.error("Block元素不存在");return}const n=f.children[1].children;if(n.length<o){console.error(`Block中不足${o}个code`);return}const a=n[o]||n[o-1];o!=n.length,w(a,o!=n.length)};function w(o,f){const d=u.value;if(!d){console.error("CaretElement元素不存在");return}const n=o.offsetTop+o.offsetHeight/2-d.offsetHeight/2,a=o.offsetLeft+(f?0:o.offsetWidth);d.style.top=`${n}px`,d.style.left=`${a}px`}return{handleTyping:k}}function ae(e,g){const{words:u,blockRefs:y,caret:k,enWords:l,startTime:w}=W($());function o(){var a,i;(a=k.value)==null||a.classList.remove("hide"),(i=k.value)==null||i.classList.add("waiting")}function f(){var a;(a=k.value)==null||a.classList.add("hide")}function d(a){const{codeElements:i,cn:v}=n(e.value[0]);if(k.value&&k.value.classList.remove("waiting"),a.code.startsWith("Key")){if(w.value||(w.value=Date.now()),l.value[e.value[0]].typing?l.value[e.value[0]].typing+=a.key:l.value[e.value[0]].typing=a.key,e.value[1]!=i.length){const r=i[e.value[1]];r.classList.add(a.key==l.value[e.value[0]].en[e.value[1]]?"correct":"wrong"),r.classList.remove("skip")}u.value.length<=e.value[0]&&console.error("block索引越界"),e.value[1]<u.value[e.value[0]].en.length?e.value[0]==u.value.length-1&&e.value[1]==l.value[e.value[0]].en.length-1?g(l.value):e.value[1]++:u.value.length>e.value[0]+1?(u.value[e.value[0]].en+=a.key,R(()=>{i[e.value[1]].classList.add("wrong"),e.value[1]++})):g(l.value)}else if(a.code==="Space")e.value[1]!=0&&(e.value[0]<u.value.length-1?([...i].slice(e.value[1],i.length).forEach(m=>m.classList.add("skip")),l.value[e.value[0]].isCorrect=l.value[e.value[0]].typing==l.value[e.value[0]].en,v.classList.toggle("wrong",!l.value[e.value[0]].isCorrect),v.classList.toggle("correct",l.value[e.value[0]].isCorrect),e.value=[e.value[0]+1,0]):g(l.value));else if(a.code==="Backspace"){if(e.value[0]==0&&e.value[1]==0)return;if(e.value[1]<=0){const{codeElements:r,cn:m}=n(e.value[0]-1),h=[...r];if(m.classList.remove("wrong","correct"),l.value[e.value[0]-1].isCorrect=void 0,h.filter(_=>_.classList.contains("skip")).length>0){let _;for(let t=0;t<h.length;t++)if(h[t].classList.contains("skip")){_=t;break}h.slice(_,h.length).forEach(t=>t.classList.remove("skip")),_?e.value=[e.value[0]-1,_]:console.error("索引元素不存在")}else e.value=[e.value[0]-1,u.value[e.value[0]-1].en.length]}else{const r=l.value[e.value[0]].typing;r&&(l.value[e.value[0]].typing=r.slice(0,-1)),e.value[1]>l.value[e.value[0]].en.length?(u.value[e.value[0]].en=u.value[e.value[0]].en.slice(0,-1),R(()=>e.value[1]--)):(e.value[1]--,i[e.value[1]].classList.remove("correct","wrong"))}}}function n(a){const i=y.value[a];if(!i){console.error("Block元素不存在");return}const v=i.children[0],m=i.children[1].children;return{cn:v,codeElements:m}}return{startTyping:o,endTyping:f,typing:d,startTime:w}}function ne(e,g,u){const{generateWords:y,updateRefs:k,settings:l}=$(),{words:w,startTime:o,blocksContainer:f,blockRefs:d}=W($());function n(v){v[g.value[0]].isCorrect=v[g.value[0]].typing==v[g.value[0]].en;const r=Date.now();if(!o.value){console.error("计时未开始");return}const m=(r-o.value)/1e3,h=Math.round(m)+"s",E=v.filter(D=>D.isCorrect).length;let _=E/m*60;_=Math.round(_*100)/100;const N=_.toFixed(2);let t=E/w.value.length;t=Math.round(t*100);const B=t+"%";e.value.wpm=N,e.value.correctness=B,e.value.during=h,u.value=!0}function a(v){d.value.forEach(r=>{r.children[0].classList.remove("wrong","correct","skip"),[...r.children[1].children].forEach(h=>{h.classList.remove("wrong","correct","skip")})}),o.value=null,i(v),u.value=!1,R(()=>{f.value&&f.value.focus(),g.value=[0,0]})}function i(v){k(),y(v)}return y(l.generateWordsNum),O(()=>{o.value=null}),{handleEnd:n,restart:a}}const b=e=>(te("data-v-3ff78069"),e=e(),se(),e),ie={class:"items-center column"},re={class:"q-ma-lg num-chooser"},ce={key:0,class:"num-chooser-split"},ue=["onClick"],ve={class:"items-center column"},pe={class:"cn-word"},fe={class:"en-word"},de=b(()=>s("span",null,"点击任意词块开始输入",-1)),me=b(()=>s("span",null,"从右上角进入设置 可以对样式和功能进行定制",-1)),ge=b(()=>s("span",null,"我们将于该提示隐藏时开始计时",-1)),he=b(()=>s("span",null,"祝玩得开心 : )",-1)),_e={class:"result items-center column"},ke={class:"row justify-around result-item-container"},ye={class:"result-item"},we={class:"result-key row items-center"},be=b(()=>s("em",{style:{"text-decoration":"underline","font-size":"14px"}},"Words Per Minute",-1)),Ce=b(()=>s("br",null,null,-1)),Te=b(()=>s("span",{style:{"font-size":"13px"}},"每分钟键入的单词数",-1)),Le={class:"result-value correct"},Be={class:"result-item"},Ee=b(()=>s("div",{class:"result-key"},"正确率",-1)),Ne={class:"result-value correct"},Se={class:"result-item"},qe=b(()=>s("div",{class:"result-key"},"用时",-1)),$e={class:"result-value correct"},ze=Y({__name:"TimeKeep",setup(e){const{words:g,caret:u,blocksContainer:y,startTime:k}=W($()),{setBlockRef:l,settings:w}=$(),o=K(!1),f=K({wpm:"",correctness:"",during:""}),d=K([0,0]),n=K(w.generateWordsNum),a=K([20,30,40,50]),{handleTyping:i}=le(d),{handleEnd:v,restart:r}=ne(f,d,o),{startTyping:m,endTyping:h,typing:E}=ae(d,v);function _(N){n.value!=N&&(n.value=N,r(n.value))}return R(()=>{y.value&&y.value.focus()}),Z(()=>{window.addEventListener("resize",i),x(d,()=>{i()},{deep:!0,immediate:!0})}),O(()=>{window.removeEventListener("resize",i)}),(N,t)=>{const B=A("q-btn"),D=A("q-tooltip"),Q=A("q-icon");return C(),T("div",ie,[s("div",re,[(C(!0),T(F,null,V(a.value,(c,z)=>(C(),T("span",{key:z},[z!=0?(C(),T("span",ce,"/")):ee("",!0),s("span",{onClick:M=>_(c),class:J([n.value==c?"correct":"","num-chooser-num"])},q(c),11,ue)]))),128))]),U(s("div",ve,[s("div",{ref_key:"blocksContainer",ref:y,onFocus:t[0]||(t[0]=(...c)=>p(m)&&p(m)(...c)),onBlur:t[1]||(t[1]=(...c)=>p(h)&&p(h)(...c)),onKeydown:[t[2]||(t[2]=(...c)=>p(E)&&p(E)(...c)),t[3]||(t[3]=P(j(()=>{},["prevent"]),["space"]))],onClick:t[4]||(t[4]=(...c)=>p(i)&&p(i)(...c)),tabindex:"0",class:"row words-container"},[s("div",{ref_key:"caret",ref:u,class:"caret"},null,512),(C(!0),T(F,null,V(p(g),(c,z)=>(C(),T("div",{ref_for:!0,ref:M=>p(l)(M,z),key:z,class:"column items-center word-block"},[s("div",pe,q(c.cn),1),s("div",fe,[(C(!0),T(F,null,V(c.en,(M,X)=>(C(),T("code",{key:X},q(M),1))),128))])]))),128))],544),L(B,{onKeydown:t[5]||(t[5]=P(j(c=>p(r)(n.value),["prevent"]),["space"])),onClick:t[6]||(t[6]=c=>p(r)(n.value)),class:"re-btn",padding:"xl",icon:"refresh",size:"lg",unelevated:""}),s("div",{class:J([p(k)?"transport":"","tip column q-mt-xl items-center"])},[de,s("span",null,[S("按"),L(B,{padding:"0px 3px",push:"",label:"Space"}),S("可以进入下一个词块")]),s("span",null,[S("输入状态"),L(B,{padding:"0px 3px",push:"",label:"Tab"}),S("后按下"),L(B,{padding:"0px 3px",push:"",label:"Space"}),S("可以重来")]),me,ge,he],2)],512),[[G,!o.value]]),L(I,{name:"result"},{default:H(()=>[U(s("div",_e,[s("div",ke,[s("div",ye,[s("div",we,[S("WPM "),L(Q,{class:"q-ml-xs cursor-pointer",name:"info"},{default:H(()=>[L(D,{"transition-show":"scale","transition-hide":"scale",class:"text-black bg-amber",anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:H(()=>[be,Ce,Te]),_:1})]),_:1})]),s("div",Le,q(f.value.wpm),1)]),s("div",Be,[Ee,s("div",Ne,q(f.value.correctness),1)]),s("div",Se,[qe,s("div",$e,q(f.value.during),1)])]),L(B,{onKeydown:t[7]||(t[7]=P(j(c=>p(r)(n.value),["prevent"]),["space"])),onClick:t[8]||(t[8]=c=>p(r)(n.value)),class:"re-btn",padding:"xl",icon:"refresh",size:"lg",unelevated:""})],512),[[G,o.value]])]),_:1})])}}}),We=oe(ze,[["__scopeId","data-v-3ff78069"]]);export{We as default};
