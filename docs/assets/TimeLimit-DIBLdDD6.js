import{s as O,r as k,A as z,w as A,B as D,n as M,a as J,c as T,e as t,j as c,m as r,C as G,k as U,u as n,x as w,D as B,h as I,i as P,T as $,p as V,q as _,F as N,f as R,E as K,t as E,_ as H}from"./index-CT5kUlc1.js";import{u as Q}from"./useSettingStore-BB-JyVop.js";let F=(W=21)=>crypto.getRandomValues(new Uint8Array(W)).reduce((f,s)=>(s&=63,s<36?f+=s.toString(36):s<62?f+=(s-26).toString(36).toUpperCase():s>62?f+="-":f+="_",f),"");function X(){const{allWords:W,settings:f}=O(Q()),s=k(),g=z(f.value.limitTime),l=k([]),h=k([]),p=k(!0),b=k({wpm:"",correctWords:[],wrongWords:[]}),y=k(null),q=k("");let u;A(g,(e,o)=>{e>0?(s.value=e,M(()=>{x()})):o?g.value=o:console.error("初始设置时间为非正数")},{deep:!0,immediate:!0});function v(){u||(u=setInterval(()=>{s.value--,s.value<=0&&(clearInterval(u),a())},1e3))}function a(){l.value.forEach(m=>{m.cn="时间已到",m.en="timeout",m.isCorrect=!1}),p.value=!1,s.value=0;const e=h.value.filter(m=>m.isCorrect),o=h.value.filter(m=>!m.isCorrect);let i=e.length/g.value*60;i=Math.round(i*100)/100;const C=i.toFixed(2);b.value={wpm:C,correctWords:e,wrongWords:o}}function x(){p.value=!0,l.value=[],h.value=[],q.value="",s.value=g.value,clearInterval(u),u=void 0,S(!0),M(()=>{y.value&&y.value.focus()})}function S(e){const o=JSON.parse(JSON.stringify(W.value));if(!o){console.error("当前无词块");return}if(o.length<5&&console.error("可用词块数不足5个！"),e){const d=[];for(let i=0;i<5;i++){const C=Math.floor(Math.random()*o.length);d.push({id:F(),...o[C]})}l.value=d}else{const d=o.splice(Math.floor(Math.random()*o.length),1)[0];l.value.push({id:F(),...d})}}function L(e){if((e.code.startsWith("Key")||e.key==" ")&&v(),e.key==" "){const{id:o,en:d,cn:i}=l.value[2],C=q.value.trim(),m=C==d||C==i;h.value.push({id:o,cn:i,en:d,typing:C,isCorrect:m}),l.value[2].isCorrect=m,M(()=>{q.value=""}),l.value.shift(),S(!1)}}const j=D(()=>{const e=Math.floor(s.value/60),o=s.value%60,d=String(e).padStart(2,"0"),i=String(o).padStart(2,"0");return`${d}:${i}`});return M(()=>{y.value&&y.value.focus()}),S(!0),{cards:l,status:p,formatTime:j,timeLimit:g,input:q,result:b,handleTyping:L,restart:x}}const Y={class:"items-center column"},Z={class:"q-mt-sm q-mb-xl row card-container items-center"},ee={class:"q-mt-xl row items-center full-width"},te={class:"col row justify-end"},se={class:"input-container shadow-3"},oe={class:"col row justify-start"},ne={class:"btn-container shadow-3"},ae={class:"result-container"},le={class:"wpm correct"},re={key:0,class:"row item-container"},ie={class:"result-item col"},ce={class:"row expansion-container"},ue={class:"result-item col"},de={class:"row expansion-container"},me=J({__name:"TimeLimit",setup(W){const{cards:f,status:s,formatTime:g,timeLimit:l,input:h,result:p,handleTyping:b,restart:y}=X();function q(u,v){let a="";return u==2?a+="mid-card ":(u==0||u==4)&&(a+="edge-card "),v.isCorrect!=null&&(v.isCorrect?a+="correct-card":a+="wrong-card"),a}return(u,v)=>{const a=V("q-card"),x=V("q-input"),S=V("q-popup-edit"),L=V("q-btn"),j=V("q-expansion-item");return _(),T("div",Y,[t("div",Z,[c(G,{name:"card",appear:""},{default:r(()=>[(_(!0),T(N,null,R(n(f),(e,o)=>(_(),K(a,{key:e.id,class:U([q(o,e),"column justify-center items-center shadow-5"])},{default:r(()=>[t("div",null,w(e.cn),1),t("div",null,w(e.en),1)]),_:2},1032,["class"]))),128))]),_:1})]),t("div",ee,[t("div",te,[t("div",null,[t("div",{class:U(["time-limit shadow-3",n(s)?"":"wrong"])},w(n(g)),3),c(S,{class:"popup",modelValue:n(l),"onUpdate:modelValue":v[0]||(v[0]=e=>B(l)?l.value=e:null),"auto-save":""},{default:r(e=>[c(x,{color:"active",placeholder:"限时时长(单位: 秒)",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,autofocus:"",onKeyup:I(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:1},8,["modelValue"])])]),t("div",se,[c(x,{ref:"inputRef",disable:!n(s),modelValue:n(h),"onUpdate:modelValue":v[1]||(v[1]=e=>B(h)?h.value=e:null),onKeydown:n(b),"input-class":"input",borderless:""},null,8,["disable","modelValue","onKeydown"])]),t("div",oe,[t("div",ne,[c(L,{onKeydown:I(P(n(y),["prevent"]),["space"]),onClick:n(y),class:"re-btn",icon:"refresh",size:"lg",flat:""},null,8,["onKeydown","onClick"])])])]),t("div",ae,[c($,{name:"wpm"},{default:r(()=>[n(s)?E("",!0):(_(),K(a,{key:0,class:"shadow-3 row justify-center"},{default:r(()=>[t("div",le,"WPM "+w(n(p).wpm),1)]),_:1}))]),_:1}),c($,{name:"word"},{default:r(()=>[n(s)?E("",!0):(_(),T("div",re,[t("div",ie,[c(a,{class:"col shadow-3 correct row justify-center"},{default:r(()=>[c(j,{"header-class":"expansion",class:"fit",label:`正确 ${n(p).correctWords.length.toString()}`},{default:r(()=>[t("div",ce,[(_(!0),T(N,null,R(n(p).correctWords,e=>(_(),K(a,{class:"shadow-3 correct-card column justify-center items-center result-block"},{default:r(()=>[t("div",null,w(e.cn),1),t("div",null,w(e.typing),1)]),_:2},1024))),256))])]),_:1},8,["label"])]),_:1})]),t("div",ue,[c(a,{class:"col shadow-3 wrong row justify-center"},{default:r(()=>[c(j,{"header-class":"expansion",class:"fit",label:`错误 ${n(p).wrongWords.length.toString()}`},{default:r(()=>[t("div",de,[(_(!0),T(N,null,R(n(p).wrongWords,e=>(_(),K(a,{class:"shadow-3 wrong-card column justify-center items-center result-block"},{default:r(()=>[t("div",null,w(e.cn),1),t("div",null,w(e.typing),1)]),_:2},1024))),256))])]),_:1},8,["label"])]),_:1})])]))]),_:1})])])}}}),ve=H(me,[["__scopeId","data-v-08ff6dde"]]);export{ve as default};
