import{s as O,r as q,A as z,w as A,B as D,n as j,a as J,c as p,e as V,f as t,k as u,p as i,C as G,l as U,u as n,x as h,D as B,i as I,j as P,T as $,q as W,F as R,g as N,E as M,t as E,_ as H}from"./index-BL9A1CZm.js";import{u as Q}from"./useSettingStore-Bf-aX0H6.js";let F=(b=21)=>crypto.getRandomValues(new Uint8Array(b)).reduce((m,s)=>(s&=63,s<36?m+=s.toString(36):s<62?m+=(s-26).toString(36).toUpperCase():s>62?m+="-":m+="_",m),"");function X(){const{allWords:b,settings:m}=O(Q()),s=q(),w=z(m.value.limitTime),r=q([]),v=q([]),T=q(!0),_=q({wpm:"",correctWords:[],wrongWords:[]}),g=q(null),y=q("");let C;A(w,(o,e)=>{o>0?(s.value=o,j(()=>{a()})):e?w.value=e:console.error("初始设置时间为非正数")},{deep:!0,immediate:!0});function x(){C||(C=setInterval(()=>{s.value--,s.value<=0&&(clearInterval(C),f())},1e3))}function f(){r.value.forEach(d=>{d.cn="时间已到",d.en="timeout",d.isCorrect=!1}),T.value=!1,s.value=0;const o=v.value.filter(d=>d.isCorrect),e=v.value.filter(d=>!d.isCorrect);let c=o.length/w.value*60;c=Math.round(c*100)/100;const k=c.toFixed(2);_.value={wpm:k,correctWords:o,wrongWords:e}}function a(){T.value=!0,r.value=[],v.value=[],y.value="",s.value=w.value,clearInterval(C),C=void 0,S(!0),j(()=>{g.value&&g.value.focus()})}function S(o){const e=JSON.parse(JSON.stringify(b.value));if(!e){console.error("当前无词块");return}if(e.length<5&&console.error("可用词块数不足5个！"),o){const l=[];for(let c=0;c<5;c++){const k=Math.floor(Math.random()*e.length);l.push({id:F(),...e[k]})}r.value=l}else{const l=e.splice(Math.floor(Math.random()*e.length),1)[0];r.value.push({id:F(),...l})}}function K(o){if((o.code.startsWith("Key")||o.key==" ")&&x(),o.key==" "){const{id:e,en:l,cn:c}=r.value[2],k=y.value.trim(),d=k==l||k==c;v.value.push({id:e,cn:c,en:l,typing:k,isCorrect:d}),r.value[2].isCorrect=d,j(()=>{y.value=""}),r.value.shift(),S(!1)}}const L=D(()=>{const o=Math.floor(s.value/60),e=s.value%60,l=String(o).padStart(2,"0"),c=String(e).padStart(2,"0");return`${l}:${c}`});return j(()=>{g.value&&g.value.focus()}),S(!0),{cards:r,status:T,formatTime:L,timeLimit:w,input:y,result:_,inputRef:g,handleTyping:K,restart:a}}const Y={class:"items-center column"},Z={class:"q-mt-sm q-mb-xl row card-container items-center"},ee={class:"q-mt-xl row items-center full-width"},te={class:"col row justify-end"},se={class:"input-container shadow-3"},oe={class:"col row justify-start"},ne={class:"btn-container shadow-3"},ae={class:"result-container"},le={class:"wpm correct"},re={key:0,class:"row item-container"},ie={class:"result-item col"},ce={class:"row expansion-container"},ue={class:"result-item col"},de={class:"row expansion-container"},me=J({__name:"TimeLimit",setup(b){const{cards:m,status:s,formatTime:w,timeLimit:r,input:v,inputRef:T,result:_,handleTyping:g,restart:y}=X();function C(x,f){let a="";return x==2?a+="mid-card ":(x==0||x==4)&&(a+="edge-card "),f.isCorrect!=null&&(f.isCorrect?a+="correct-card":a+="wrong-card"),a}return(x,f)=>{const a=W("q-card"),S=W("q-input"),K=W("q-popup-edit"),L=W("q-btn"),o=W("q-expansion-item");return p(),V("div",Y,[t("div",Z,[u(G,{name:"card",appear:""},{default:i(()=>[(p(!0),V(R,null,N(n(m),(e,l)=>(p(),M(a,{key:e.id,class:U([C(l,e),"column justify-center items-center shadow-5"])},{default:i(()=>[t("div",null,h(e.cn),1),t("div",null,h(e.en),1)]),_:2},1032,["class"]))),128))]),_:1})]),t("div",ee,[t("div",te,[t("div",null,[t("div",{class:U(["time-limit shadow-3",n(s)?"":"wrong"])},h(n(w)),3),u(K,{class:"popup",modelValue:n(r),"onUpdate:modelValue":f[0]||(f[0]=e=>B(r)?r.value=e:null),"auto-save":""},{default:i(e=>[u(S,{color:"active",placeholder:"限时时长(单位: 秒)",modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,autofocus:"",onKeyup:I(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:1},8,["modelValue"])])]),t("div",se,[u(S,{ref_key:"inputRef",ref:T,disable:!n(s),modelValue:n(v),"onUpdate:modelValue":f[1]||(f[1]=e=>B(v)?v.value=e:null),onKeydown:n(g),"input-class":"input",borderless:""},null,8,["disable","modelValue","onKeydown"])]),t("div",oe,[t("div",ne,[u(L,{onKeydown:I(P(n(y),["prevent"]),["space"]),onClick:n(y),class:"re-btn",icon:"refresh",size:"lg",flat:""},null,8,["onKeydown","onClick"])])])]),t("div",ae,[u($,{name:"wpm"},{default:i(()=>[n(s)?E("",!0):(p(),M(a,{key:0,class:"shadow-3 row justify-center"},{default:i(()=>[t("div",le,"WPM "+h(n(_).wpm),1)]),_:1}))]),_:1}),u($,{name:"word"},{default:i(()=>[n(s)?E("",!0):(p(),V("div",re,[t("div",ie,[u(a,{class:"col shadow-3 correct row justify-center"},{default:i(()=>[u(o,{"header-class":"expansion",class:"fit",label:`正确 ${n(_).correctWords.length.toString()}`},{default:i(()=>[t("div",ce,[(p(!0),V(R,null,N(n(_).correctWords,e=>(p(),M(a,{class:"shadow-3 correct-card column justify-center items-center result-block"},{default:i(()=>[t("div",null,h(e.cn),1),t("div",null,h(e.typing),1)]),_:2},1024))),256))])]),_:1},8,["label"])]),_:1})]),t("div",ue,[u(a,{class:"col shadow-3 wrong row justify-center"},{default:i(()=>[u(o,{"header-class":"expansion",class:"fit",label:`错误 ${n(_).wrongWords.length.toString()}`},{default:i(()=>[t("div",de,[(p(!0),V(R,null,N(n(_).wrongWords,e=>(p(),M(a,{class:"shadow-3 wrong-card column justify-center items-center result-block"},{default:i(()=>[t("div",null,h(e.cn),1),t("div",null,h(e.typing),1)]),_:2},1024))),256))])]),_:1},8,["label"])]),_:1})])]))]),_:1})])])}}}),ve=H(me,[["__scopeId","data-v-361001fe"]]);export{ve as default};
