import{d as Z,s as M,r as b,n as K,o as Q,a as x,b as I,w as ee,c as C,e as T,f as n,F,g as V,h as J,v as O,u as g,i as L,j as A,k as U,l as G,m as $,p as P,T as te,q as j,t as se,x as W,y as oe,z as le,_ as ne}from"./index-Bod516PY.js";import{u as H}from"./useSettingStore-DLVheZFV.js";const q=Z("typing",()=>{const{allWords:e}=M(H()),m=b(null),c=b([]),k=b([]);function h(s){const t=JSON.parse(JSON.stringify(e.value));if(!t){console.error("当前无词块");return}t.length<s&&(console.error(`可用词块数不足${s}个！当前最多生成${t.length}个词块`),s=t.length),c.value=[];for(let i=0;i<s;i++){const u=Math.floor(Math.random()*t.length),r=t.splice(u,1)[0];c.value.push(r)}k.value=c.value.map(({cn:i,...u})=>u)}const a=b(null),o=b([]),f=b(null),d=(s,t)=>{s&&(o.value[t]=s)};function p(){o.value=[];for(let s=0;s<c.value.length;s++){const t=o.value[s];t&&o.value.push(t)}}return{words:c,caret:a,blockRefs:o,enWords:k,startTime:m,blocksContainer:f,setBlockRef:d,generateWords:h,updateRefs:p}});function ae(e){const{blockRefs:m,caret:c}=M(q()),k=()=>{const o=m.value[e.value[0]];if(!o){console.error("Block元素未定义");return}h(e.value[1],o)},h=(o,f)=>{if(!f){console.error("Block元素不存在");return}const p=f.children[1].children;if(p.length<o){console.error(`Block中不足${o}个code`);return}const s=p[o]||p[o-1];a(s,o!=p.length)};function a(o,f){const d=c.value;if(!d){console.error("CaretElement元素不存在");return}const p=o.offsetTop+o.offsetHeight/2-d.offsetHeight/2,s=o.offsetLeft+(f?0:o.offsetWidth);d.style.top=`${p}px`,d.style.left=`${s}px`}return{handleTyping:k}}function ie(e,m){const{words:c,blockRefs:k,caret:h,enWords:a,startTime:o}=M(q());function f(){var t,i;(t=h.value)==null||t.classList.remove("hide"),(i=h.value)==null||i.classList.add("waiting")}function d(){var t;(t=h.value)==null||t.classList.add("hide")}function p(t){const{codeElements:i,cn:u}=s(e.value[0]);if(h.value&&h.value.classList.remove("waiting"),t.code.startsWith("Key")){if(o.value||(o.value=Date.now()),a.value[e.value[0]].typing?a.value[e.value[0]].typing+=t.key:a.value[e.value[0]].typing=t.key,e.value[1]!=i.length){const r=i[e.value[1]];r.classList.add(t.key==a.value[e.value[0]].en[e.value[1]]?"correct":"wrong"),r.classList.remove("skip")}c.value.length<=e.value[0]&&console.error("block索引越界"),e.value[1]<c.value[e.value[0]].en.length?e.value[0]==c.value.length-1&&e.value[1]==a.value[e.value[0]].en.length-1?m(a.value):e.value[1]++:c.value.length>e.value[0]+1?(c.value[e.value[0]].en+=t.key,K(()=>{i[e.value[1]].classList.add("wrong"),e.value[1]++})):m(a.value)}else if(t.code==="Space")e.value[1]!=0&&(e.value[0]<c.value.length-1?([...i].slice(e.value[1],i.length).forEach(_=>_.classList.add("skip")),a.value[e.value[0]].isCorrect=a.value[e.value[0]].typing==a.value[e.value[0]].en,u.classList.toggle("wrong",!a.value[e.value[0]].isCorrect),u.classList.toggle("correct",a.value[e.value[0]].isCorrect),e.value=[e.value[0]+1,0]):m(a.value));else if(t.code==="Backspace"){if(e.value[0]==0&&e.value[1]==0)return;if(e.value[1]<=0){const{codeElements:r,cn:_}=s(e.value[0]-1),y=[...r];if(_.classList.remove("wrong","correct"),a.value[e.value[0]-1].isCorrect=void 0,y.filter(w=>w.classList.contains("skip")).length>0){let w;for(let l=0;l<y.length;l++)if(y[l].classList.contains("skip")){w=l;break}y.slice(w,y.length).forEach(l=>l.classList.remove("skip")),w?e.value=[e.value[0]-1,w]:console.error("索引元素不存在")}else e.value=[e.value[0]-1,c.value[e.value[0]-1].en.length]}else{const r=a.value[e.value[0]].typing;r&&(a.value[e.value[0]].typing=r.slice(0,-1)),e.value[1]>a.value[e.value[0]].en.length?(c.value[e.value[0]].en=c.value[e.value[0]].en.slice(0,-1),K(()=>e.value[1]--)):(e.value[1]--,i[e.value[1]].classList.remove("correct","wrong"))}}}function s(t){const i=k.value[t];if(!i){console.error("Block元素不存在");return}const u=i.children[0],_=i.children[1].children;return{cn:u,codeElements:_}}return{startTyping:f,endTyping:d,typing:p,startTime:o}}function re(e,m,c){const{settings:k}=H(),{generateWords:h,updateRefs:a}=q(),{words:o,startTime:f,blocksContainer:d,blockRefs:p}=M(q());function s(u){u[m.value[0]].isCorrect=u[m.value[0]].typing==u[m.value[0]].en;const r=Date.now();if(!f.value){console.error("计时未开始");return}const _=(r-f.value)/1e3,y=Math.round(_)+"s",E=u.filter(D=>D.isCorrect).length;let w=E/_*60;w=Math.round(w*100)/100;const N=w.toFixed(2);let l=E/o.value.length;l=Math.round(l*100);const B=l+"%";e.value.wpm=N,e.value.correctness=B,e.value.during=y,c.value=!0}function t(u){p.value.forEach(r=>{r.children[0].classList.remove("wrong","correct","skip"),[...r.children[1].children].forEach(y=>{y.classList.remove("wrong","correct","skip")})}),f.value=null,i(u),c.value=!1,K(()=>{d.value&&d.value.focus(),m.value=[0,0]})}function i(u){a(),h(u)}return h(k.generateWordsNum),Q(()=>{f.value=null}),{handleEnd:s,restart:t}}const S=e=>(oe("data-v-5d4a1658"),e=e(),le(),e),ce={class:"items-center column"},ue={class:"q-ma-lg num-chooser"},ve={key:0,class:"num-chooser-split"},fe=["onClick"],de={class:"items-center column"},pe={class:"cn-word"},ge={class:"en-word"},me=S(()=>n("span",null,"点击词块即可开始输入",-1)),he=S(()=>n("span",null,"输入第一个字母后开始计时",-1)),_e={class:"result items-center column"},ke={class:"row justify-around result-item-container"},ye={class:"result-item"},we={class:"result-key row items-center"},be=S(()=>n("b",null,[n("em",{style:{"text-decoration":"underline","font-size":"14px"}},"Words Per Minute")],-1)),Ce=S(()=>n("br",null,null,-1)),Te=S(()=>n("span",{style:{"font-size":"13px"}},"每分钟键入的单词数",-1)),Le={class:"result-value correct"},Be={class:"result-item"},Se=S(()=>n("div",{class:"result-key"},"正确率",-1)),Ee={class:"result-value correct"},Ne={class:"result-item"},We=S(()=>n("div",{class:"result-key"},"用时",-1)),qe={class:"result-value correct"},Re=x({__name:"TimeKeep",setup(e){const{words:m,caret:c,blocksContainer:k,startTime:h}=M(q()),{setBlockRef:a}=q(),{settings:o}=H(),f=b(!1),d=b({wpm:"",correctness:"",during:""}),p=b([0,0]),s=b(o.generateWordsNum),t=b([20,30,40,50]),{handleTyping:i}=ae(p),{handleEnd:u,restart:r}=re(d,p,f),{startTyping:_,endTyping:y,typing:E}=ie(p,u);function w(N){s.value!=N&&(s.value=N,r(s.value))}return K(()=>{k.value&&k.value.focus()}),I(()=>{window.addEventListener("resize",i),ee(p,()=>{i()},{deep:!0,immediate:!0})}),Q(()=>{window.removeEventListener("resize",i)}),(N,l)=>{const B=j("q-btn"),D=j("q-tooltip"),X=j("q-icon");return C(),T("div",ce,[n("div",ue,[(C(!0),T(F,null,V(t.value,(v,R)=>(C(),T("span",{key:R},[R!=0?(C(),T("span",ve,"/")):se("",!0),n("span",{onClick:z=>w(v),class:G([s.value==v?"correct":"","num-chooser-num"])},W(v),11,fe)]))),128))]),J(n("div",de,[n("div",{ref_key:"blocksContainer",ref:k,onFocus:l[0]||(l[0]=(...v)=>g(_)&&g(_)(...v)),onBlur:l[1]||(l[1]=(...v)=>g(y)&&g(y)(...v)),onKeydown:l[2]||(l[2]=(...v)=>g(E)&&g(E)(...v)),onClick:l[3]||(l[3]=(...v)=>g(i)&&g(i)(...v)),tabindex:"0",class:"row words-container"},[n("div",{ref_key:"caret",ref:c,class:"caret"},null,512),(C(!0),T(F,null,V(g(m),(v,R)=>(C(),T("div",{ref_for:!0,ref:z=>g(a)(z,R),key:R,class:"column items-center word-block"},[n("div",pe,W(v.cn),1),n("div",ge,[(C(!0),T(F,null,V(v.en,(z,Y)=>(C(),T("code",{key:Y},W(z),1))),128))])]))),128))],544),L(B,{onKeydown:l[4]||(l[4]=A(U(v=>g(r)(s.value),["prevent"]),["space"])),onClick:l[5]||(l[5]=v=>g(r)(s.value)),class:"re-btn",padding:"xl",icon:"refresh",size:"lg",unelevated:""}),n("div",{class:G([g(h)?"transport":"","tip column q-mt-xl items-center"])},[me,n("span",null,[$("按"),L(B,{padding:"0px 3px",push:"",label:"Space"}),$("进入下一个词块")]),he,n("span",null,[L(B,{padding:"0px 3px",push:"",label:"Tab"}),$("+"),L(B,{padding:"0px 3px",push:"",label:"Space"}),$("可以快速刷新")])],2)],512),[[O,!f.value]]),L(te,{name:"result"},{default:P(()=>[J(n("div",_e,[n("div",ke,[n("div",ye,[n("div",we,[$("WPM "),L(X,{color:"text",class:"q-ml-xs cursor-pointer",name:"info"},{default:P(()=>[L(D,{"transition-show":"scale","transition-hide":"scale",class:"text-btnText bg-active",anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:P(()=>[be,Ce,Te]),_:1})]),_:1})]),n("div",Le,W(d.value.wpm),1)]),n("div",Be,[Se,n("div",Ee,W(d.value.correctness),1)]),n("div",Ne,[We,n("div",qe,W(d.value.during),1)])]),L(B,{onKeydown:l[6]||(l[6]=A(U(v=>g(r)(s.value),["prevent"]),["space"])),onClick:l[7]||(l[7]=v=>g(r)(s.value)),class:"re-btn",padding:"xl",icon:"refresh",size:"lg",unelevated:""})],512),[[O,f.value]])]),_:1})])}}}),ze=ne(Re,[["__scopeId","data-v-5d4a1658"]]);export{ze as default};
